<ui:composition template="template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core"
	xmlns:ui="jakarta.faces.facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">

		<h:form id="emergencyForm">

			<p:growl id="msgs" showDetail="true" />

			<p:panel header="Emergency Encounter Details">

				<p:outputLabel for="searchName" value="Search Patient by Name:" />
				<p:inputText id="searchName" value="#{emergencyBean.searchName}"
					placeholder="Enter name" />

				<p:commandButton value="Find" action="#{emergencyBean.findPatient}"
					process="@this searchName" update="@form" icon="pi pi-search" />

				<p:dataTable id="patientTable"
					value="#{emergencyBean.searchResults}" var="p"
					rowKey="#{p.pid}"
					selection="#{emergencyBean.patient}"
					selectionMode="single">

					<p:ajax event="rowSelect"
						process="@this"
						listener="#{emergencyBean.onRowSelect}"
						update=":emergencyForm:encounterWrapper :emergencyForm:msgs" />

					<p:column selectionMode="single" style="width:40px" />
					<p:column headerText="PID">#{p.pid}</p:column>
					<p:column headerText="Patient Name">#{p.firstName} #{p.lastName}</p:column>
					<p:column headerText="Father Name">#{p.fatherName}</p:column>
					<p:column headerText="Gender">#{p.gender}</p:column>
					<p:column headerText="City">#{p.city}</p:column>
					<p:column headerText="Action">
						<p:commandButton value="Details" 
							onclick="PF('patientDialog').show()" 
							update=":patientDetailForm"
							process="@this">
							<f:setPropertyActionListener target="#{emergencyBean.selectedPatient}" value="#{p}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<p:outputPanel id="encounterWrapper">

					<p:outputPanel rendered="#{not empty emergencyBean.patient}">

						<p:separator />

						<h3>Selected Patient: #{emergencyBean.patientName}</h3>

						<p:fieldset legend="Patient Information" style="margin-bottom:15px">
							<p:panelGrid columns="4">
								<p:outputLabel value="Patient ID:" />
								<h:outputText value="#{emergencyBean.patientId}" />
								<p:outputLabel value="Father Name:" />
								<h:outputText value="#{emergencyBean.fatherName}" />
								<p:outputLabel value="Gender:" />
								<h:outputText value="#{emergencyBean.gender}" />
								<p:outputLabel value="Age:" />
								<h:outputText value="#{emergencyBean.age}" />
								<p:outputLabel value="CNIC:" />
								<h:outputText value="#{emergencyBean.cnicNo}" />
								<p:outputLabel value="Address:" />
								<h:outputText value="#{emergencyBean.address}" />
							</p:panelGrid>
						</p:fieldset>

						
					</p:outputPanel>

				</p:outputPanel>

			</p:panel>

		</h:form>
		
		<p:dialog header="Patient Details" widgetVar="patientDialog" modal="true" width="500">
			<h:form id="patientDetailForm">
				<p:panelGrid columns="2" rendered="#{emergencyBean.selectedPatient != null}">
					<p:outputLabel value="Patient ID:" />
					<h:outputText value="#{emergencyBean.selectedPatient.pid}" />
					
					<p:outputLabel value="Full Name:" />
					<h:outputText value="#{emergencyBean.selectedPatient.firstName} #{emergencyBean.selectedPatient.lastName}" />
					
					<p:outputLabel value="Father Name:" />
					<h:outputText value="#{emergencyBean.selectedPatient.fatherName}" />
					
					<p:outputLabel value="Date of Birth:" />
					<h:outputText value="#{emergencyBean.selectedPatient.dob}">
						<f:convertDateTime pattern="dd-MM-yyyy" />
					</h:outputText>
					
					<p:outputLabel value="Gender:" />
					<h:outputText value="#{emergencyBean.selectedPatient.gender}" />
					
					<p:outputLabel value="CNIC:" />
					<h:outputText value="#{emergencyBean.selectedPatient.cnicNo}" />
					
					
					
					<p:outputLabel value="Address:" />
					<h:outputText value="#{emergencyBean.selectedPatient.street}, #{emergencyBean.selectedPatient.town}, #{emergencyBean.selectedPatient.city}" />
				</p:panelGrid>
			</h:form>
		</p:dialog>

	</ui:define>

</ui:composition>
