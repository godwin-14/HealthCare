<ui:composition template="template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="jakarta.faces.html"
    xmlns:f="jakarta.faces.core"
    xmlns:ui="jakarta.faces.facelets"
    xmlns:p="http://primefaces.org/ui">

    <ui:define name="content">
        <h:form id="treatmentForm">

            <p:growl id="msgs" showDetail="true" />

            <p:panel header="Treatment">

                <p:panelGrid columns="2" styleClass="ui-fluid">
                    <p:outputLabel value="Patient ID:" />
                    <p:inputText value="#{treatmentBean.patientId}" style="width:100px;"/>
                    <p:commandButton value="Load Patient"
                        action="#{treatmentBean.loadPatient}"
                        update="@form" style="width:160px;"/>
                </p:panelGrid>

                <p:outputPanel rendered="#{not empty treatmentBean.patient}">

                    <p:fieldset legend="Patient Details" style="margin-top:20px">
                        <p:panelGrid columns="4" columnClasses="label,value,label,value">

                            <p:outputLabel value="Name:" />
                            <h:outputText
                                value="#{treatmentBean.patient.firstName} #{treatmentBean.patient.lastName}" />

                            <p:outputLabel value="PID:" />
                            <h:outputText value="#{treatmentBean.patient.pid}" />

                            <p:outputLabel value="Father/Husband:" />
                            <h:outputText value="#{treatmentBean.patient.fatherName}" />

                            <p:outputLabel value="DOB:" />
                            <h:outputText value="#{treatmentBean.patient.dob}">
                                <f:convertDateTime pattern="dd-MM-yyyy"/>
                            </h:outputText>

                            <p:outputLabel value="Gender:" />
                            <h:outputText value="#{treatmentBean.patient.gender}" />

                            <p:outputLabel value="CNIC No:" />
                            <h:outputText value="#{treatmentBean.patient.cnicNo}" />

                            <p:outputLabel value="Address:" />
                            <h:outputText
                                value="#{treatmentBean.patient.street}, #{treatmentBean.patient.city}" />

                            <p:outputLabel value="MLC:" />
                            <h:outputText value="#{treatmentBean.mlc}" />

                        </p:panelGrid>
                    </p:fieldset>


                    <p:fieldset legend="Latest Vitals" rendered="#{not empty treatmentBean.latestTPRB}" style="margin-top:20px">
                        <p:panelGrid columns="4" columnClasses="label,value,label,value">

                            <p:outputLabel value="BP:" />
							<h:outputText value="#{treatmentBean.latestTPRB.bpMin} / #{treatmentBean.latestTPRB.bpMax}" />

                            <p:outputLabel value="Temperature:" />
                            <h:outputText value="#{treatmentBean.latestTPRB.temperature}" />

                            <p:outputLabel value="Pulse:" />
                            <h:outputText value="#{treatmentBean.latestTPRB.pulseRate}" />

                            <p:outputLabel value="Respiration:" />
                            <h:outputText value="#{treatmentBean.latestTPRB.respirationRate}" />

                        </p:panelGrid>

                        <p:commandButton value="View Previous TPRB"
                            action="#{treatmentBean.loadPreviousTPRB}"
                            update="previousTPRBPanel"
                            style="margin-top:10px" />
                    </p:fieldset>

                    <p:outputPanel id="previousTPRBPanel"
                        rendered="#{treatmentBean.showPreviousTPRB}">

                        <p:fieldset legend="Previous TPRB Details"
                            style="margin-top:20px">

                            <p:dataTable value="#{treatmentBean.previousTPRBList}"
                                var="t" paginator="true" rows="5">

                                <p:column headerText="Date">
                                    <h:outputText value="#{t.encounterDate}">
                                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="BP">
                                    <h:outputText value="#{t.bp}" />
                                </p:column>

                                <p:column headerText="Temperature">
                                    <h:outputText value="#{t.temperature}" />
                                </p:column>

                                <p:column headerText="Pulse">
                                    <h:outputText value="#{t.pulse}" />
                                </p:column>

                                <p:column headerText="Respiration">
                                    <h:outputText value="#{t.respiration}" />
                                </p:column>

                            </p:dataTable>
                        </p:fieldset>
                    </p:outputPanel>

                    <p:fieldset legend="Clinical Notes" style="margin-top:20px">
                        <p:panelGrid columns="2" styleClass="ui-fluid">

                            <p:outputLabel value="Presenting Complaints:" />
                            <p:inputTextarea value="#{treatmentBean.presentingComplaints}" rows="3" />

                            <p:outputLabel value="Disease Set:" />
                            <p:inputTextarea value="#{treatmentBean.diseaseSet}" rows="2" 
                                placeholder="Enter diseases separated by commas" />

                            <p:outputLabel value="Provisional Diagnosis:" />
                            <p:inputText value="#{treatmentBean.provisionalDiagnosis}" 
                                placeholder="Enter diagnosis" />

                        </p:panelGrid>
                    </p:fieldset>

                    <p:fieldset legend="Prescribed Medicines" style="margin-top:20px">
                        <p:dataTable value="#{treatmentBean.medicines}" var="row">

                            <p:column headerText="Medicine">
                                <p:selectOneMenu value="#{row.medicine}">
                                    <f:selectItems value="#{treatmentBean.allMedicines}"
                                        var="m" itemValue="#{m}"
                                        itemLabel="#{m.medicineName}" />
                                </p:selectOneMenu>
                            </p:column>

                            <p:column headerText="Timings">
                                <p:inputText value="#{row.timings}" />
                            </p:column>

                            <p:column headerText="Qty">
                                <p:inputText value="#{row.qty}" />
                            </p:column>

                            <p:column headerText="Period">
                                <p:inputText value="#{row.period}" />
                            </p:column>

                            <p:column headerText="Comments">
                                <p:inputText value="#{row.comments}" />
                            </p:column>

                        </p:dataTable>

                        <p:commandButton value="Add Medicine"
                            action="#{treatmentBean.addMedicineRow}"
                            update="@form"
                            style="margin-top:10px" />
                    </p:fieldset>

                    <p:commandButton value="Submit"
                        action="#{treatmentBean.submitTreatment}"
                        update="@form"
                        styleClass="ui-button-success" />

                </p:outputPanel>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
